- name: Deploy contracts (this may take a while, logs - {{ playbook_dir }}/logs/sm-deploy.log)
  shell: bash {{ playbook_dir }}/../../helper-scripts/deploy_manager.sh 2>&1 | tee {{ playbook_dir }}/logs/sm-deploy.log
  run_once: yes
  environment:
    MANAGER_TAG: "{{ manager_tag }}"
    ETH_PRIVATE_KEY: "{{ eth_private_key }}"
    ENDPOINT: "{{ endpoint }}"
    GAS_PRICE: "{{ deploy_gas_price }}"
    NETWORK: "custom"
  tags:
    - deploy_sm
    - deploy_contracts
- name: Copy to s3
  aws_s3:
    aws_access_key: "{{ aws_key }}"
    aws_secret_key: "{{ aws_secret }}"
    bucket: "skale-abis"
    #bucket: skale-binaries
    src: "{{ playbook_dir }}/../../helper-scripts/deploy_manager.sh"
    object: 'deploy_manager.sh'
    region: 'eu-central-1'
    mode: put
    # overwrite: "no"
    permission: "public-read"
    # ignore_nonexistent_bucket: True
  tags:
    - upload_contracts
  register: url_output
- name: Use result
  debug:
   msg: >-
     ffff {{ url_output.url }}
  tags:
    - upload_contracts
